<%# Tailwind-styled pagination partial. Usage: render 'shared/tailwind_pagination', paginated: @items %>
<% paginated = local_assigns[:paginated] || local_assigns[:collection] || paginated %>

<%# Determine current per-page value (from paginated object if present, otherwise params or default) %>
<% current_per = if paginated && paginated.respond_to?(:limit_value)
  paginated.limit_value
else
  (params[:per].to_i.nonzero? || 10)
end %>

<%# Support plain Arrays in view specs: compute pagination values when Kaminari methods aren't available %>
<% if paginated && paginated.respond_to?(:total_pages) %>
  <% total_pages = paginated.total_pages %>
  <% current_page = paginated.current_page %>
  <% prev_page = paginated.prev_page %>
  <% next_page = paginated.next_page %>
<% else %>
  <% size = paginated.respond_to?(:size) ? paginated.size : (paginated.present? ? Array(paginated).size : 0) %>
  <% current_page = params[:page].to_i.nonzero? || 1 %>
  <% per = (current_per || 10).to_i %>
  <% per = 10 if per <= 0 %>
  <% total_pages = per > 0 ? (size.to_f / per).ceil : 0 %>
  <% prev_page = current_page > 1 ? current_page - 1 : nil %>
  <% next_page = current_page < total_pages ? current_page + 1 : nil %>
<% end %>

<div class="flex items-center justify-center mt-6 space-x-4">
  <%# Per-page selector form - preserves other query params except page and per %>
  <div class="flex items-center space-x-2">
    <span class="text-sm text-gray-600">Mostrar</span>
    <%= form_with url: request.path, method: :get, local: true, class: "inline" do %>
      <% request.query_parameters.each do |k, v| %>
        <% next if %w[per page].include?(k) %>
        <%= hidden_field_tag k, v %>
      <% end %>
      <%= select_tag :per, options_for_select([ 10, 25, 50, 100 ], current_per), onchange: 'this.form.submit()', class: "mt-1 block w-full pl-3 pr-10 py-1 text-sm border border-gray-200 rounded-md bg-white text-gray-700" %>
    <% end %>
  </div>

  <%# Guard: nothing to render for single page or missing collection %>
  <% if total_pages && total_pages > 1 %>
    <nav role="navigation" aria-label="Pagination Navigation" class="flex items-center">
      <ul class="inline-flex items-center -space-x-px">
      <%# Prev button %>
      <% if prev_page %>
        <li>
          <%= link_to url_for(request.params.merge(page: prev_page)), class: "px-3 py-1 rounded-l-md border border-gray-200 bg-white text-gray-700 hover:bg-gray-50" , aria: { label: "Previous" } do %>
            &lsaquo;
          <% end %>
        </li>
      <% else %>
        <li>
          <span class="px-3 py-1 rounded-l-md border border-gray-200 bg-gray-100 text-gray-400">&lsaquo;</span>
        </li>
      <% end %>

      <%# Page numbers: simple full range (acceptable for modest page counts) %>
      <% 1.upto(total_pages) do |p| %>
        <% if p == current_page %>
          <li>
            <span class="px-3 py-1 border-t border-b border-gray-200 bg-blue-600 text-white"><%= p %></span>
          </li>
        <% else %>
          <li>
            <%= link_to p, url_for(request.params.merge(page: p)), class: "px-3 py-1 border border-gray-200 bg-white text-gray-700 hover:bg-gray-50" %>
          </li>
        <% end %>
      <% end %>

      <%# Next button %>
      <% if next_page %>
        <li>
          <%= link_to url_for(request.params.merge(page: next_page)), class: "px-3 py-1 rounded-r-md border border-gray-200 bg-white text-gray-700 hover:bg-gray-50", aria: { label: "Next" } do %>
            &rsaquo;
          <% end %>
        </li>
      <% else %>
        <li>
          <span class="px-3 py-1 rounded-r-md border border-gray-200 bg-gray-100 text-gray-400">&rsaquo;</span>
        </li>
      <% end %>
      </ul>
    </nav>
  <% end %>
</div>

<% case modal %>
<% when "name" %>
  <%= form_with(model: entity, url: entity_path(entity), method: :patch, class: "space-y-4") do |form| %>
    <%= hidden_field_tag "modal", "name" %>
    <div>
      <%= form.label :name, "Nombre", class: "block text-sm font-semibold text-gray-700 mb-2" %>
      <%= form.text_field :name, class: "block w-full px-3 py-3 border-2 #{entity.errors[:name].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "Nombre de la entidad" %>
      <% if entity.errors[:name].any? %>
        <p class="mt-2 text-sm text-red-600"><%= entity.errors[:name].first %></p>
      <% end %>
    </div>
    <div class="flex justify-end gap-3">
      <button type="button" data-action="click->modal#close" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">Cancelar</button>
      <%= form.submit "Guardar", class: "px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors" %>
    </div>
  <% end %>
<% when "fiscal" %>
  <%= form_with(model: entity, url: entity_path(entity), method: :patch, class: "space-y-4") do |form| %>
    <%= hidden_field_tag "modal", "fiscal" %>
    <% if entity.fiscal_profile %>
      <%= form.fields_for :fiscal_profile do |fp| %>
        <div>
          <%= fp.label :rfc, "RFC", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= fp.text_field :rfc, class: "block w-full px-3 py-3 border-2 #{entity.fiscal_profile.errors[:rfc].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "XAXX010101000", maxlength: 13 %>
          <% if entity.fiscal_profile.errors[:rfc].any? %>
            <p class="mt-2 text-sm text-red-600"><%= entity.fiscal_profile.errors[:rfc].first %></p>
          <% end %>
        </div>
        <div>
          <%= fp.label :razon_social, "Razón Social", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= fp.text_field :razon_social, class: "block w-full px-3 py-3 border-2 #{entity.fiscal_profile.errors[:razon_social].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "Razón social completa" %>
          <% if entity.fiscal_profile.errors[:razon_social].any? %>
            <p class="mt-2 text-sm text-red-600"><%= entity.fiscal_profile.errors[:razon_social].first %></p>
          <% end %>
        </div>
        <div>
          <%= fp.label :regimen, "Régimen Fiscal", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= fp.select :regimen, FiscalProfile::REGIMENES.map { |k, v| ["#{k} - #{v}", k] }, { include_blank: "Seleccionar régimen" }, class: "block w-full px-3 py-3 border-2 #{entity.fiscal_profile.errors[:regimen].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900" %>
          <% if entity.fiscal_profile.errors[:regimen].any? %>
            <p class="mt-2 text-sm text-red-600"><%= entity.fiscal_profile.errors[:regimen].first %></p>
          <% end %>
        </div>
        <div>
          <%= fp.label :uso_cfdi, "Uso CFDI", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= fp.select :uso_cfdi, FiscalProfile::USOS_CFDI.map { |k, v| ["#{k} - #{v}", k] }, { include_blank: "Seleccionar uso CFDI" }, class: "block w-full px-3 py-3 border-2 #{entity.fiscal_profile.errors[:uso_cfdi].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900" %>
          <% if entity.fiscal_profile.errors[:uso_cfdi].any? %>
            <p class="mt-2 text-sm text-red-600"><%= entity.fiscal_profile.errors[:uso_cfdi].first %></p>
          <% end %>
        </div>
        <div>
          <%= fp.label :forma_pago, "Forma de Pago", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= fp.select :forma_pago, FiscalProfile::FORMAS_PAGO.map { |k, v| ["#{k} - #{v}", k] }, { include_blank: "Seleccionar forma de pago" }, class: "block w-full px-3 py-3 border-2 #{entity.fiscal_profile.errors[:forma_pago].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900" %>
          <% if entity.fiscal_profile.errors[:forma_pago].any? %>
            <p class="mt-2 text-sm text-red-600"><%= entity.fiscal_profile.errors[:forma_pago].first %></p>
          <% end %>
        </div>
        <div>
          <%= fp.label :metodo_pago, "Método de Pago", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= fp.select :metodo_pago, FiscalProfile::METODOS_PAGO.map { |k, v| ["#{k} - #{v}", k] }, { include_blank: "Seleccionar método de pago" }, class: "block w-full px-3 py-3 border-2 #{entity.fiscal_profile.errors[:metodo_pago].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900" %>
          <% if entity.fiscal_profile.errors[:metodo_pago].any? %>
            <p class="mt-2 text-sm text-red-600"><%= entity.fiscal_profile.errors[:metodo_pago].first %></p>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <p class="text-sm text-gray-500">No hay perfil fiscal. Se creará automáticamente al guardar.</p>
    <% end %>
    <div class="flex justify-end gap-3">
      <button type="button" data-action="click->modal#close" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">Cancelar</button>
      <%= form.submit "Guardar", class: "px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors" %>
    </div>
  <% end %>
<% when "patent" %>
  <%= form_with(model: entity, url: entity_path(entity), method: :patch, class: "space-y-4") do |form| %>
    <%= hidden_field_tag "modal", "patent" %>
    <%= form.fields_for :customs_agent_patents do |patent_form| %>
      <div>
        <%= patent_form.label :patent_number, "Número de Patente", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= patent_form.text_field :patent_number, class: "block w-full px-3 py-3 border-2 #{entity.customs_agent_patents.any? && entity.customs_agent_patents.first.errors[:patent_number].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "Número de patente aduanal" %>
        <% if entity.customs_agent_patents.any? && entity.customs_agent_patents.first.errors[:patent_number].any? %>
          <p class="mt-2 text-sm text-red-600"><%= entity.customs_agent_patents.first.errors[:patent_number].first %></p>
        <% end %>
      </div>
    <% end %>
    <div class="flex justify-end gap-3">
      <button type="button" data-action="click->modal#close" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">Cancelar</button>
      <%= form.submit "Guardar", class: "px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors" %>
    </div>
  <% end %>
<% when "address" %>
  <%= form_with(model: entity, url: entity_path(entity), method: :patch, class: "space-y-4") do |form| %>
    <%= hidden_field_tag "modal", "address" %>
    <%= form.fields_for :addresses do |address_form| %>
      <div>
        <%= address_form.label :tipo, "Tipo", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= address_form.select :tipo, Address::TIPOS.map { |k, v| [v, k] }, { include_blank: "Seleccionar tipo" }, class: "block w-full px-3 py-3 border-2 #{entity.addresses.any? && entity.addresses.first.errors[:tipo].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900" %>
        <% if entity.addresses.any? && entity.addresses.first.errors[:tipo].any? %>
          <p class="mt-2 text-sm text-red-600"><%= entity.addresses.first.errors[:tipo].first %></p>
        <% end %>
      </div>
      <div>
        <%= address_form.label :calle, "Calle", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= address_form.text_field :calle, class: "block w-full px-3 py-3 border-2 #{entity.addresses.any? && entity.addresses.first.errors[:calle].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "Nombre de la calle" %>
        <% if entity.addresses.any? && entity.addresses.first.errors[:calle].any? %>
          <p class="mt-2 text-sm text-red-600"><%= entity.addresses.first.errors[:calle].first %></p>
        <% end %>
      </div>
      <div>
        <%= address_form.label :numero_exterior, "Número Exterior", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= address_form.text_field :numero_exterior, class: "block w-full px-3 py-3 border-2 #{entity.addresses.any? && entity.addresses.first.errors[:numero_exterior].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "123" %>
        <% if entity.addresses.any? && entity.addresses.first.errors[:numero_exterior].any? %>
          <p class="mt-2 text-sm text-red-600"><%= entity.addresses.first.errors[:numero_exterior].first %></p>
        <% end %>
      </div>
      <div>
        <%= address_form.label :numero_interior, "Número Interior", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= address_form.text_field :numero_interior, class: "block w-full px-3 py-3 border-2 #{entity.addresses.any? && entity.addresses.first.errors[:numero_interior].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "A, B, etc. (opcional)" %>
        <% if entity.addresses.any? && entity.addresses.first.errors[:numero_interior].any? %>
          <p class="mt-2 text-sm text-red-600"><%= entity.addresses.first.errors[:numero_interior].first %></p>
        <% end %>
      </div>
      <div>
        <%= address_form.label :colonia, "Colonia", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= address_form.text_field :colonia, class: "block w-full px-3 py-3 border-2 #{entity.addresses.any? && entity.addresses.first.errors[:colonia].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "Nombre de la colonia" %>
        <% if entity.addresses.any? && entity.addresses.first.errors[:colonia].any? %>
          <p class="mt-2 text-sm text-red-600"><%= entity.addresses.first.errors[:colonia].first %></p>
        <% end %>
      </div>
      <div>
        <%= address_form.label :codigo_postal, "Código Postal", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= address_form.text_field :codigo_postal, class: "block w-full px-3 py-3 border-2 #{entity.addresses.any? && entity.addresses.first.errors[:codigo_postal].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "12345" %>
        <% if entity.addresses.any? && entity.addresses.first.errors[:codigo_postal].any? %>
          <p class="mt-2 text-sm text-red-600"><%= entity.addresses.first.errors[:codigo_postal].first %></p>
        <% end %>
      </div>
      <div>
        <%= address_form.label :municipio, "Municipio", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= address_form.text_field :municipio, class: "block w-full px-3 py-3 border-2 #{entity.addresses.any? && entity.addresses.first.errors[:municipio].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "Nombre del municipio" %>
        <% if entity.addresses.any? && entity.addresses.first.errors[:municipio].any? %>
          <p class="mt-2 text-sm text-red-600"><%= entity.addresses.first.errors[:municipio].first %></p>
        <% end %>
      </div>
      <div>
        <%= address_form.label :estado, "Estado", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= address_form.text_field :estado, class: "block w-full px-3 py-3 border-2 #{entity.addresses.any? && entity.addresses.first.errors[:estado].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "Nombre del estado" %>
        <% if entity.addresses.any? && entity.addresses.first.errors[:estado].any? %>
          <p class="mt-2 text-sm text-red-600"><%= entity.addresses.first.errors[:estado].first %></p>
        <% end %>
      </div>
      <div>
        <%= address_form.label :pais, "País", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= address_form.select :pais, Address::PAISES.map { |k, v| [v, k] }, { include_blank: "Seleccionar país" }, class: "block w-full px-3 py-3 border-2 #{entity.addresses.any? && entity.addresses.first.errors[:pais].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900" %>
        <% if entity.addresses.any? && entity.addresses.first.errors[:pais].any? %>
          <p class="mt-2 text-sm text-red-600"><%= entity.addresses.first.errors[:pais].first %></p>
        <% end %>
      </div>
      <div>
        <%= address_form.label :email, "Email", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= address_form.email_field :email, class: "block w-full px-3 py-3 border-2 #{entity.addresses.any? && entity.addresses.first.errors[:email].any? ? 'border-red-300' : 'border-gray-200'} focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "correo@ejemplo.com" %>
        <% if entity.addresses.any? && entity.addresses.first.errors[:email].any? %>
          <p class="mt-2 text-sm text-red-600"><%= entity.addresses.first.errors[:email].first %></p>
        <% end %>
      </div>
    <% end %>
    <div class="flex justify-end gap-3">
      <button type="button" data-action="click->modal#close" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">Cancelar</button>
      <%= form.submit "Guardar", class: "px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors" %>
    </div>
  <% end %>
<% end %>
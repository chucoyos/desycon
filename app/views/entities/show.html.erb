<% content_for :title, @entity.name %>

<div id="entity_show" class="w-full px-4 sm:px-6 lg:px-8 py-6 sm:py-8" data-controller="modal">
  <%= render "entities/header", entity: @entity %>

  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Fiscal Profile -->
    <div id="fiscal_profile_container">
      <%= render "entities/fiscal_profile_section", entity: @entity %>
    </div>

    <% if @entity.is_customs_broker %>
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div class="px-4 sm:px-6 py-4 bg-gradient-to-r from-indigo-50 to-indigo-100 border-b border-indigo-200">
          <div class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-indigo-600">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-8.84 9.28a.75.75 0 0 0-.75-.75h-.375a1.125 1.125 0 0 1-1.125-1.125V6.75a1.125 1.125 0 0 1 1.125-1.125h.375a.75.75 0 0 0 .75-.75c0-.231-.035-.454-.1-.664M3 6.75h.007v.008H3V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
            </svg>
            <h2 class="text-base sm:text-lg font-semibold text-gray-900">Patente</h2>
          </div>
        </div>
        <div class="px-4 sm:px-6 py-4">
          <p class="text-sm text-gray-600">Número de patente</p>
          <p class="text-lg font-semibold text-gray-900"><%= @entity.patent_number.presence || "N/A" %></p>
        </div>
      </div>
    <% end %>

    <% if policy(@entity).manage_brokers? && @entity.is_customs_agent %>
      <div id="brokers_container">
        <%= render "entities/brokers_section", entity: @entity %>
      </div>
    <% end %>

    <% if policy(@entity).manage_brokers? && @entity.is_customs_broker %>
      <div id="agencies_container">
        <%= render "entities/agencies_section", entity: @entity %>
      </div>
    <% end %>
  </div>

  <!-- Roles -->
  <div id="roles_container" class="mt-6">
    <%= render "entities/roles_section", entity: @entity %>
  </div>

  <!-- Addresses -->
  <%= render "entities/addresses_section", entity: @entity %>
</div>

<!-- Modals -->
<%= render "entities/name_modal", entity: @entity %>
<%= render "entities/fiscal_modal", entity: @entity %>
<%= render "entities/roles_modal", entity: @entity %>
<%= render "entities/address_modal", entity: @entity %>

<!-- Address Edit Modal -->
<div id="address-modal" data-modal-target="modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" data-action="click->modal#closeOnBackdrop">
  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
    <div class="mt-3">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-medium text-gray-900">Editar Dirección</h3>
        <button type="button" data-action="click->modal#close" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div id="edit-address-form-container">
        <!-- Form will be loaded dynamically here -->
        <p class="text-gray-500 text-center py-4">Cargando formulario...</p>
      </div>
    </div>
  </div>
</div>

<!-- New Address Modal -->
<div id="new-address-modal" data-modal-target="modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" data-action="click->modal#closeOnBackdrop">
  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
    <div class="mt-3">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-medium text-gray-900">Agregar Nueva Dirección</h3>
        <button type="button" data-action="click->modal#close" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <%= form_with(model: Address.new, url: entity_addresses_path(@entity), method: :post, class: "space-y-4", id: "new_address_form") do |form| %>
        <div>
          <%= form.label :tipo, "Tipo", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= form.select :tipo, Address::TIPOS.map { |k, v| [v, k] }, { include_blank: "Seleccionar tipo" }, class: "block w-full px-3 py-3 border-2 border-gray-200 focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900" %>
        </div>
        <div>
          <%= form.label :calle, "Calle", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= form.text_field :calle, class: "block w-full px-3 py-3 border-2 border-gray-200 focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "Nombre de la calle" %>
        </div>
        <div>
          <%= form.label :numero_exterior, "Número Exterior", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= form.text_field :numero_exterior, class: "block w-full px-3 py-3 border-2 border-gray-200 focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "123" %>
        </div>
        <div>
          <%= form.label :numero_interior, "Número Interior", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= form.text_field :numero_interior, class: "block w-full px-3 py-3 border-2 border-gray-200 focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "A, B, etc. (opcional)" %>
        </div>
        <div>
          <%= form.label :colonia, "Colonia", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= form.text_field :colonia, class: "block w-full px-3 py-3 border-2 border-gray-200 focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "Nombre de la colonia" %>
        </div>
        <div>
          <%= form.label :codigo_postal, "Código Postal", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= form.text_field :codigo_postal, class: "block w-full px-3 py-3 border-2 border-gray-200 focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "12345" %>
        </div>
        <div>
          <%= form.label :municipio, "Municipio", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= form.text_field :municipio, class: "block w-full px-3 py-3 border-2 border-gray-200 focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "Nombre del municipio" %>
        </div>
        <div>
          <%= form.label :estado, "Estado", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= form.text_field :estado, class: "block w-full px-3 py-3 border-2 border-gray-200 focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "Nombre del estado" %>
        </div>
        <div>
          <%= form.label :pais, "País", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= form.select :pais, Address.paises_con_banderas.map { |display, code| [display, code] }, { include_blank: "Seleccionar país" }, class: "block w-full px-3 py-3 border-2 border-gray-200 focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900" %>
        </div>
        <div>
          <%= form.label :email, "Email", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= form.email_field :email, class: "block w-full px-3 py-3 border-2 border-gray-200 focus:border-teal-500 focus:ring-teal-500 rounded-lg focus:ring-2 transition-all duration-200 text-gray-900", placeholder: "correo@ejemplo.com" %>
        </div>
        <div class="flex justify-end gap-3">
          <button type="button" data-action="click->modal#close" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">Cancelar</button>
          <%= form.submit "Agregar Dirección", class: "px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors" %>
        </div>
      <% end %>
    </div>
  </div>
</div>



<% entity ||= @entity %>

<%= form_with model: [ entity, Address.new ], class: "address-form p-4 bg-gray-50 border border-gray-200 rounded-lg mb-3", data: { turbo: true } do |f| %>
  <%= hidden_field_tag :context, "edit" %>
  <div class="space-y-3">
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      <div>
        <%= f.label :tipo, "Tipo", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :tipo,
            Address::TIPOS.map { |k, v| [v, k] },
            { include_blank: "Seleccionar tipo" },
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-teal-500 focus:ring-teal-500 text-gray-900" %>
        <% if f.object.errors[:tipo].any? %>
          <p class="text-sm text-red-600 mt-1"><%= f.object.errors[:tipo].first %></p>
        <% end %>
      </div>
      <div>
        <%= f.label :email, "Email", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.email_field :email,
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-teal-500 focus:ring-teal-500 text-gray-900",
            placeholder: "correo@ejemplo.com" %>
        <% if f.object.errors[:email].any? %>
          <p class="text-sm text-red-600 mt-1"><%= f.object.errors[:email].first %></p>
        <% end %>
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
      <div class="sm:col-span-2">
        <%= f.label :calle, "Calle", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :calle,
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-teal-500 focus:ring-teal-500 text-gray-900",
            placeholder: "Nombre de la calle" %>
        <% if f.object.errors[:calle].any? %>
          <p class="text-sm text-red-600 mt-1"><%= f.object.errors[:calle].first %></p>
        <% end %>
      </div>
      <div>
        <%= f.label :numero_exterior, "Núm. Ext.", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :numero_exterior,
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-teal-500 focus:ring-teal-500 text-gray-900",
            placeholder: "123" %>
        <% if f.object.errors[:numero_exterior].any? %>
          <p class="text-sm text-red-600 mt-1"><%= f.object.errors[:numero_exterior].first %></p>
        <% end %>
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
      <div>
        <%= f.label :numero_interior, "Núm. Int.", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :numero_interior,
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-teal-500 focus:ring-teal-500 text-gray-900",
            placeholder: "A" %>
        <% if f.object.errors[:numero_interior].any? %>
          <p class="text-sm text-red-600 mt-1"><%= f.object.errors[:numero_interior].first %></p>
        <% end %>
      </div>
      <div>
        <%= f.label :colonia, "Colonia", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :colonia,
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-teal-500 focus:ring-teal-500 text-gray-900",
            placeholder: "Colonia" %>
        <% if f.object.errors[:colonia].any? %>
          <p class="text-sm text-red-600 mt-1"><%= f.object.errors[:colonia].first %></p>
        <% end %>
      </div>
      <div>
        <%= f.label :codigo_postal, "CP", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :codigo_postal,
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-teal-500 focus:ring-teal-500 text-gray-900",
            placeholder: "12345" %>
        <% if f.object.errors[:codigo_postal].any? %>
          <p class="text-sm text-red-600 mt-1"><%= f.object.errors[:codigo_postal].first %></p>
        <% end %>
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
      <div>
        <%= f.label :municipio, "Municipio", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :municipio,
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-teal-500 focus:ring-teal-500 text-gray-900",
            placeholder: "Municipio" %>
        <% if f.object.errors[:municipio].any? %>
          <p class="text-sm text-red-600 mt-1"><%= f.object.errors[:municipio].first %></p>
        <% end %>
      </div>
      <div>
        <%= f.label :estado, "Estado", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :estado,
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-teal-500 focus:ring-teal-500 text-gray-900",
            placeholder: "Estado" %>
        <% if f.object.errors[:estado].any? %>
          <p class="text-sm text-red-600 mt-1"><%= f.object.errors[:estado].first %></p>
        <% end %>
      </div>
      <div>
        <%= f.label :pais, "País", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :pais,
            Address.paises_con_banderas,
            { include_blank: "Seleccionar país" },
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-teal-500 focus:ring-teal-500 text-gray-900" %>
        <% if f.object.errors[:pais].any? %>
          <p class="text-sm text-red-600 mt-1"><%= f.object.errors[:pais].first %></p>
        <% end %>
      </div>
    </div>

    <div class="flex items-center gap-2 pt-2">
      <%= f.submit "Guardar Dirección",
          class: "px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors duration-150 font-medium" %>
      <%= button_tag type: "button",
          onclick: "document.getElementById('new_address').innerHTML = ''; document.getElementById('add-address-btn').style.display = 'inline-flex';",
          class: "px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors duration-150 font-medium" do %>
        Cancelar
      <% end %>
    </div>
  </div>
<% end %>
